# !/bin/python
# -*- coding: utf-8 -*-
u"""SecureTea Social Engineering
Project:
    ╔═╗┌─┐┌─┐┬ ┬┬─┐┌─┐╔╦╗┌─┐┌─┐
    ╚═╗├┤ │  │ │├┬┘├┤  ║ ├┤ ├─┤
    ╚═╝└─┘└─┘└─┘┴└─└─┘ ╩ └─┘┴ ┴
    Author: Digvijay Bhosale <digvijayb1729@gmail.com> August 25 2021
    Version: 1.0
    Module: SecureTea
"""

import os
import json

from securetea.lib.malware_analysis.fileAnalysis import FileAnalyser
from securetea.lib.malware_analysis.malwareAnalysis import MalwareAnalysis
from securetea.lib.malware_analysis.continuous_malware_defence import ContinuousDefence
from securetea.lib.malware_analysis import globals
from securetea.lib.malware_analysis.mal_gui import app_runner


class SecureTeaMalwareAnalysis:
    def __init__(self, creds):
        self.mode = creds['mode']
        self.api_key = ''
        self.filename = ''
        globals.initialize_colours()

    def runner(self):
        if self.mode.lower() == 'i' or self.mode.lower() == 'm':
            while True:
                self.filename = input("Enter Filename\n\t:")
                if os.path.isfile(self.filename):
                    break
                else:
                    print(globals.WARNING + 'Given Filename does not exist. ' + globals.END)

        if self.mode.lower() == 'c':
            GUI = True
            globals.initialize_flask()
            thread1 = ContinuousDefence(gui=GUI)

            # Start new Thread for MalwareAnalysis
            thread1.start()
            if GUI:
                app_runner()

            thread1.join()
        elif self.mode.lower() == 'i':
            f_analysis = FileAnalyser(self.filename)
            f_analysis.start_analysis()
        elif self.mode.lower() == 'm':
            self.api_key = input('Enter VirusTotal API Key\n\t:')
            m_analysis = MalwareAnalysis(filename=self.filename, API_KEY=self.api_key)
            m_analysis.runner()
        else:
            print("Incorrect option selected")
            return
